<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-title="Applicant"
        default-menu-include="false"
        default-menu-index="3">

    <parameter name="orderId" required="true"/>
    <parameter name="orderPartSeqId" required="true"/>
    <parameter name="partyId"/>
    <parameter name="assetId"/>

    <transition name="storePrimaryApplicant">
        <service-call name="mkdecision.dashboard.OrderServices.store#PrimaryApplicant" in-map="context" out-map="context"/>
        <conditional-response url="../Property">
            <condition>
                <expression>continueButton != null</expression>
            </condition>
            <parameter name="orderId"/>
            <parameter name="orderPartSeqId"/>
            <parameter name="partyId"/>
            <parameter name="assetId"/>
        </conditional-response>
        <default-response url="."/>
    </transition>
    <transition name="deleteEmployment">
        <service-call name="mkdecision.dashboard.OrderServices.delete#Employment" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="viewOrderHeader">
        <default-response url="../OrderHeader">
            <parameter name="orderId"/>
            <parameter name="orderPartSeqId"/>
            <parameter name="partyId"/>
            <parameter name="assetId"/>
        </default-response>
    </transition>
    <transition name="calculateTotalNonEmploymentIncome">
        <actions>
            <set field="totalNonEmploymentIncome" from="0" type="BigDecimal"/>
            <script><![CDATA[
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(rentIncome == null ? BigDecimal.ZERO : new BigDecimal(rentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(retirementIncome == null ? BigDecimal.ZERO : new BigDecimal(retirementIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(investmentIncome == null ? BigDecimal.ZERO : new BigDecimal(investmentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(bonusIncome == null ? BigDecimal.ZERO : new BigDecimal(bonusIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(socialSecurityIncome == null ? BigDecimal.ZERO : new BigDecimal(socialSecurityIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(disabilityIncome == null ? BigDecimal.ZERO : new BigDecimal(disabilityIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(studentIncome == null ? BigDecimal.ZERO : new BigDecimal(studentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(unemploymentIncome == null ? BigDecimal.ZERO : new BigDecimal(unemploymentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(alimonyIncome == null ? BigDecimal.ZERO : new BigDecimal(alimonyIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(childSupportIncome == null ? BigDecimal.ZERO : new BigDecimal(childSupportIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(otherIncome == null ? BigDecimal.ZERO : new BigDecimal(otherIncome))
            ]]></script>
            <script>ec.web.sendTextResponse(String.format("%f", totalNonEmploymentIncome))</script>
        </actions>
        <default-response type="none"/>
    </transition>

    <actions>
        <if condition="partyId != null">
            <entity-find-one entity-name="mantle.party.Person" value-field="party"/>
            <set field="firstName" from="party?.firstName ?: ''"/>
            <set field="middleName" from="party?.middleName ?: ''"/>
            <set field="lastName" from="party?.lastName ?: ''"/>
            <set field="suffix" from="party?.suffix ?: ''"/>
            <set field="birthDate" from="ec.l10n.format(party?.birthDate, 'MM-dd-yyyy') ?: ''"/>
            <set field="maritalStatusEnumId" from="party?.maritalStatusEnumId ?: ''"/>
            <set field="employmentStatusEnumId" from="party?.employmentStatusEnumId ?: ''"/>
            <set field="occupation" from="party?.occupation ?: ''"/>

            <entity-find entity-name="mantle.party.contact.PartyContactMechPostalAddress" list="postalAddressList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="contactMechPurposeId" value="PostalHome"/>
                <date-filter/>
            </entity-find>
            <set field="address1" from="postalAddressList?.getFirst()?.address1 ?: ''"/>
            <set field="unitNumber" from="postalAddressList?.getFirst()?.unitNumber ?: ''"/>
            <set field="postalCode" from="postalAddressList?.getFirst()?.postalCode ?: ''"/>
            <set field="city" from="postalAddressList?.getFirst()?.city ?: ''"/>
            <set field="stateProvinceGeoId" from="postalAddressList?.getFirst()?.stateProvinceGeoId ?: ''"/>

            <entity-find entity-name="mantle.party.contact.PartyContactMechTelecomNumber" list="telecomNumberList">
                <econdition field-name="partyId" from="partyId"/>
                <date-filter/>
            </entity-find>
            <set field="contactNumber" from="telecomNumberList?.getFirst()?.contactNumber ?: ''"/>
            <set field="contactMechPurposeId" from="telecomNumberList?.getFirst()?.contactMechPurposeId ?: ''"/>

            <entity-find entity-name="mantle.party.contact.PartyContactMechInfo" list="emailList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="contactMechPurposeId" value="EmailPrimary"/>
                <date-filter/>
            </entity-find>
            <set field="email" from="emailList?.getFirst()?.infoString ?: ''"/>
            <set field="emailVerify" from="emailList?.getFirst()?.infoString ?: ''"/>

            <entity-find entity-name="mantle.party.contact.PartyContactMechPostalAddress" list="postalAddressList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="contactMechPurposeId" value="PostalHome"/>
                <date-filter/>
            </entity-find>

            <entity-find entity-name="mantle.party.PartyIdentification" list="socialSecurityNumberList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="partyIdTypeEnumId" value="PtidSsn"/>
            </entity-find>
            <set field="socialSecurityNumber" from="socialSecurityNumberList?.getFirst()?.idValue ?: ''"/>

            <entity-find entity-name="mantle.party.PartyIdentification" list="idList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="partyIdTypeEnumId" operator="not-equals" value="PtidSsn"/>
            </entity-find>
            <set field="idTypeEnumId" from="idList?.getFirst()?.partyIdTypeEnumId ?: ''"/>
            <set field="idIssuedBy" from="idList?.getFirst()?.issuedBy ?: ''"/>
            <set field="idValue" from="idList?.getFirst()?.idValue ?: ''"/>
            <set field="idIssueDate" from="ec.l10n.format(idList?.getFirst()?.issueDate, 'MM-dd-yyyy') ?: ''"/>
            <set field="idExpiryDate" from="ec.l10n.format(idList?.getFirst()?.expireDate, 'MM-dd-yyyy') ?: ''"/>

            <entity-find entity-name="mantle.party.PartyToAndRelationship" list="employmentRelationList">
                <econdition field-name="relationshipTypeEnumId" value="PrtEmployee"/>
                <econdition field-name="fromPartyId" from="partyId"/>
                <econdition field-name="fromRoleTypeId" value="Employee"/>
            </entity-find>

            <entity-find entity-name="mk.close.FinancialFlow" list="rentIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowRent"/>
            </entity-find>
            <set field="rentIncome" from="rentIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="retirementIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowRetirement"/>
            </entity-find>
            <set field="retirementIncome" from="retirementIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="investmentIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowInvestment"/>
            </entity-find>
            <set field="investmentIncome" from="investmentIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="bonusIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowBonus"/>
            </entity-find>
            <set field="bonusIncome" from="bonusIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="socialSecurityIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowSocialSecurity"/>
            </entity-find>
            <set field="socialSecurityIncome" from="socialSecurityIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="disabilityIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowDisability"/>
            </entity-find>
            <set field="disabilityIncome" from="disabilityIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="studentIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowStudent"/>
            </entity-find>
            <set field="studentIncome" from="studentIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="unemploymentIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowUnemployment"/>
            </entity-find>
            <set field="unemploymentIncome" from="unemploymentIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="alimonyIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowAlimony"/>
            </entity-find>
            <set field="alimonyIncome" from="alimonyIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="childSupportIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowChildSupport"/>
            </entity-find>
            <set field="childSupportIncome" from="childSupportIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <entity-find entity-name="mk.close.FinancialFlow" list="otherIncomeFinFlowList">
                <econdition field-name="partyId" from="partyId"/>
                <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowOther"/>
            </entity-find>
            <set field="otherIncome" from="otherIncomeFinFlowList?.getFirst()?.amount ?: ''"/>

            <set field="totalNonEmploymentIncome" from="0" type="BigDecimal"/>
            <script><![CDATA[
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(rentIncome == null || rentIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(rentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(retirementIncome == null || retirementIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(retirementIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(investmentIncome == null || investmentIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(investmentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(bonusIncome == null || bonusIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(bonusIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(socialSecurityIncome == null || socialSecurityIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(socialSecurityIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(disabilityIncome == null || disabilityIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(disabilityIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(studentIncome == null || studentIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(studentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(unemploymentIncome == null || unemploymentIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(unemploymentIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(alimonyIncome == null || alimonyIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(alimonyIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(childSupportIncome == null || childSupportIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(childSupportIncome))
                totalNonEmploymentIncome = totalNonEmploymentIncome.add(otherIncome == null || otherIncome.trim().equals("") ? BigDecimal.ZERO : new BigDecimal(otherIncome))
            ]]></script>
        </if>
    </actions>

    <widgets>
        <form-single name="ApplicantForm" transition="storePrimaryApplicant">
            <field name="orderId"><default-field><hidden/></default-field></field>
            <field name="orderPartSeqId"><default-field><hidden/></default-field></field>
            <field name="partyId"><default-field><hidden/></default-field></field>
            <field name="assetId"><default-field><hidden/></default-field></field>

            <field name="applicantHeader">
                <default-field>
                    <label text="New Application" type="h4" style="margin-b-1"/>
                    <label text="Primary Applicant" type="h5" style="margin-b-1"/>
                    <label text="Please add all parties associated with the new application." style="margin-b-1"/>
                    <container style="h-separator margin-tb-2"/>
                </default-field>
            </field>
            <field name="personaInfoHeader">
                <default-field>
                    <label text="Personal Information" type="h5" style="margin-tb-1"/>
                    <container style="h-separator margin-tb-1"/>
                </default-field>
            </field>
            <field name="firstName">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="middleName">
                <default-field title="M.I (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="lastName">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="suffix">
                <default-field title="Suffix (Optional)">
                    <text-line/>
                </default-field>
            </field>

            <field name="addressHeader">
                <default-field>
                    <label text="Residential Address" type="h5" style="margin-tb-1"/>
                    <container style="h-separator margin-tb-1"/>
                </default-field>
            </field>
            <field name="address1">
                <default-field title="Residential Address">
                    <text-line/>
                </default-field>
            </field>
            <field name="unitNumber">
                <default-field title="Apt / Unit # (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="postalCode">
                <default-field title="ZIP Code">
                    <text-line/>
                </default-field>
            </field>
            <field name="city">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="stateProvinceGeoId">
                <default-field title="State">
                    <drop-down allow-empty="true">
                        <entity-options text="${geoName}" key="${toGeoId}">
                            <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                <econdition field-name="geoId" value="USA"/>
                                <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                <order-by field-name="geoName"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>

            <field name="identityHeader">
                <default-field>
                    <label text="Identity Information" type="h5" style="margin-tb-1"/>
                    <container style="h-separator margin-tb-1"/>
                </default-field>
            </field>
            <field name="socialSecurityNumber">
                <default-field>
                    <text-line mask="###-##-####"/>
                </default-field>
            </field>
            <field name="birthDate">
                <default-field title="Date of Birth">
                    <date-time type="date" size="200" format="MM-dd-yyyy"/>
                </default-field>
            </field>
            <field name="idTypeEnumId">
                <default-field title="ID Type (Optional)">
                    <drop-down allow-empty="true">
                        <entity-options text="${description}" key="${enumId}">
                            <entity-find entity-name="moqui.basic.EnumAndGroup">
                                <econdition field-name="enumGroupEnumId" value="DefaultDashboardIdGroup"/>
                                <order-by field-name="sequenceNum,description"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>
            <field name="idIssuedBy">
                <default-field title="ID State Issued (Optional)">
                    <drop-down allow-empty="true">
                        <entity-options text="${geoName}" key="${geoName}">
                            <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                <econdition field-name="geoId" value="USA"/>
                                <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                <order-by field-name="geoName"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>
            <field name="idValue">
                <default-field title="ID Number (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="idIssueDate">
                <default-field title="Issue Date (Optional)">
                    <date-time type="date" size="200" format="MM-dd-yyyy"/>
                </default-field>
            </field>
            <field name="idExpiryDate">
                <default-field title="Expiration Date (Optional)">
                    <date-time type="date" size="200" format="MM-dd-yyyy"/>
                </default-field>
            </field>
            <field name="maritalStatusEnumId">
                <default-field title="Marital Status">
                    <drop-down allow-empty="true">
                        <entity-options text="${description}" key="${enumId}">
                            <entity-find entity-name="moqui.basic.Enumeration">
                                <econdition field-name="enumTypeId" value="MaritalStatus"/>
                                <order-by field-name="sequenceNum,description"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>

            <field name="contactHeader">
                <default-field>
                    <label text="Contact Information" type="h5" style="margin-tb-1"/>
                    <container style="h-separator margin-tb-1"/>
                </default-field>
            </field>
            <field name="contactNumber">
                <default-field title="Phone Number">
                    <text-line mask="###-###-####"/>
                </default-field>
            </field>
            <field name="contactMechPurposeId">
                <default-field title="Type">
                    <drop-down allow-empty="true">
                        <entity-options text="${description}" key="${contactMechPurposeId}">
                            <entity-find entity-name="mantle.party.contact.ContactMechPurpose">
                                <econdition field-name="contactMechTypeEnumId" value="CmtTelecomNumber"/>
                                <econdition field-name="contactMechPurposeId" operator="in" from="['PhoneHome', 'PhoneMobile', 'PhoneWork']"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>
            <field name="email">
                <default-field title="Email Address">
                    <text-line/>
                </default-field>
            </field>
            <field name="emailVerify">
                <default-field title="Verify Email Address">
                    <text-line/>
                </default-field>
            </field>

            <field name="financialHeader">
                <default-field>
                    <label text="Financial Information" type="h5" style="margin-tb-1"/>
                    <container style="h-separator margin-tb-1"/>
                </default-field>
            </field>
            <field name="employmentHeader">
                <default-field>
                    <label text="Employment" type="strong" style="margin-tb-1"/>
                </default-field>
            </field>
            <field name="occupation">
                <default-field title="Occupation">
                    <text-line/>
                </default-field>
            </field>

            <field name="employmentTipHeader">
                <default-field>
                    <label text="Please enter all employments for the past 2 years." style="margin-tb-1"/>
                </default-field>
            </field>
            <field name="employmentRelations">
                <default-field>
                    <section-iterate name="EmploymentRelationIterator" list="employmentRelationList" entry="employmentRelation">
                        <actions>
                            <set field="years" from="1"/>
                            <set field="months" from="1"/>
                            <entity-find-one entity-name="mk.close.FinancialFlow" value-field="financialFlow">
                                <field-map field-name="partyId" from="employmentRelation.fromPartyId"/>
                                <field-map field-name="financialFlowTypeEnumId" value="MkFinFlowTotalMonthlyIncome"/>
                                <field-map field-name="entryTypeEnumId" value="MkEntryIncome"/>
                                <field-map field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                            </entity-find-one>

                            <entity-find entity-name="mantle.party.contact.PartyContactMechPostalAddress" list="employerPostalAddressList">
                                <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                                <econdition field-name="contactMechPurposeId" value="PostalPrimary"/>
                                <date-filter/>
                            </entity-find>
                            <set field="employerAddress1" from="employerPostalAddressList?.getFirst()?.address1 ?: ''"/>
                            <set field="employerUnitNumber" from="employerPostalAddressList?.getFirst()?.unitNumber ?: ''"/>
                            <set field="employerPostalCode" from="employerPostalAddressList?.getFirst()?.postalCode ?: ''"/>
                            <set field="employerCity" from="employerPostalAddressList?.getFirst()?.city ?: ''"/>
                            <set field="employerStateGeoName" from="employerPostalAddressList?.getFirst()?.stateGeoName ?: ''"/>

                            <entity-find entity-name="mantle.party.contact.PartyContactMechTelecomNumber" list="employerTelecomNumberList">
                                <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                                <date-filter/>
                            </entity-find>
                            <set field="employerContactNumber" from="employerTelecomNumberList?.getFirst()?.contactNumber ?: ''"/>
                        </actions>
                        <widgets>
                            <form-single name="EmploymentRelation">
                                <field name="relationshipHeader">
                                    <default-field>
                                        <label text="Employment ${sectionEntryIndex + 1}" style="margin-tb-1"/>
                                    </default-field>
                                </field>
                                <field name="relationshipAction">
                                    <default-field>
                                        <link text="Remove Employment" btn-type="danger" url="deleteEmployment" parameter-map="[orderId: orderId, orderPartSeqId: orderPartSeqId, partyId: partyId, assetId: assetId, partyRelationshipId: employmentRelation.partyRelationshipId]" />
                                    </default-field>
                                </field>

                                <field name="employerName">
                                    <default-field>
                                        <display text="${employmentRelation.organizationName}" style="bg-grey-1"/>
                                    </default-field>
                                </field>
                                <field name="jobTitle">
                                    <default-field title="Title">
                                        <display text="${employmentRelation.relationshipName}" style="bg-grey-1"/>
                                    </default-field>
                                </field>
                                <field name="durationHeader">
                                    <default-field>
                                        <label text="Duration" style="margin-tb-1"/>
                                    </default-field>
                                </field>
                                <field name="years">
                                    <default-field>
                                        <display style="bg-grey-1 margin-r-05"/>
                                    </default-field>
                                </field>
                                <field name="months">
                                    <default-field>
                                        <display style="bg-grey-1 margin-l-05"/>
                                    </default-field>
                                </field>
                                <field name="monthlyIncome">
                                    <default-field title="Pre-Tax Income Monthly">
                                        <display text="${financialFlow.amount}" style="bg-grey-1"/>
                                    </default-field>
                                </field>
                                <field name="employerAddress1">
                                    <default-field title="Employer Address (Optional)">
                                        <display style="bg-grey-1"/>
                                    </default-field>
                                </field>
                                <field name="employerUnitNumber">
                                    <default-field title="Apt / Unit # (Optional)">
                                        <display style="bg-grey-1 margin-r-05"/>
                                    </default-field>
                                </field>
                                <field name="employerPostalCode">
                                    <default-field title="ZIP Code">
                                        <display style="bg-grey-1 margin-l-05"/>
                                    </default-field>
                                </field>
                                <field name="employerCity">
                                    <default-field>
                                        <display style="bg-grey-1 margin-r-05"/>
                                    </default-field>
                                </field>
                                <field name="employerStateGeoName">
                                    <default-field title="State">
                                        <display style="bg-grey-1 margin-l-05"/>
                                    </default-field>
                                </field>
                                <field name="employerContactNumber">
                                    <default-field title="Employer Phone Number (Optional)">
                                        <display style="bg-grey-1"/>
                                    </default-field>
                                </field>

                                <field-layout>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="6" sm="6" md="6" lg="6" style="margin-all-0"><field-ref name="relationshipHeader"/></field-col>
                                        <field-col xs="6" sm="6" md="6" lg="6" style="margin-all-0 text-right"><field-ref name="relationshipAction"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerName"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="jobTitle"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="monthlyIncome"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerAddress1"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerUnitNumber"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerPostalCode"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerCity"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerStateGeoName"/></field-col>
                                    </field-col-row>
                                    <field-col-row style="nested-form-field">
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerContactNumber"/></field-col>
                                    </field-col-row>
                                </field-layout>
                            </form-single>
                        </widgets>
                    </section-iterate>
                </default-field>
            </field>
            <field name="employmentNumberHeader">
                <default-field>
                    <label text="Employment ${(employmentRelationList?.size() ?: 0) + 1}" style="margin-tb-1"/>
                </default-field>
            </field>
            <field name="employmentStatusEnumId">
                <default-field title="Employment Status">
                    <drop-down allow-empty="true">
                        <entity-options text="${description}" key="${enumId}">
                            <entity-find entity-name="moqui.basic.Enumeration">
                                <econdition field-name="enumTypeId" value="EmploymentStatus"/>
                                <order-by field-name="sequenceNum,description"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>
            <field name="employerName">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="jobTitle">
                <default-field title="Title">
                    <text-line/>
                </default-field>
            </field>

            <field name="durationHeader">
                <default-field>
                    <label text="Duration" style="margin-tb-1"/>
                </default-field>
            </field>
            <field name="years">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="months">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="monthlyIncome">
                <default-field title="Pre-Tax Income Monthly">
                    <text-line/>
                </default-field>
            </field>
            <field name="employerAddress1">
                <default-field title="Employer Address (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="employerUnitNumber">
                <default-field title="Apt / Unit # (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="employerPostalCode">
                <default-field title="ZIP Code">
                    <text-line/>
                </default-field>
            </field>
            <field name="employerCity">
                <default-field>
                    <text-line/>
                </default-field>
            </field>
            <field name="employerStateProvinceGeoId">
                <default-field title="State">
                    <drop-down allow-empty="true">
                        <entity-options text="${geoName}" key="${toGeoId}">
                            <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                <econdition field-name="geoId" value="USA"/>
                                <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                <order-by field-name="geoName"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </default-field>
            </field>
            <field name="employerContactNumber">
                <default-field title="Employer Phone Number (Optional)">
                    <text-line  mask="###-###-####"/>
                </default-field>
            </field>

            <field name="nonEmploymentHeader">
                <default-field>
                    <label text="Non-Employment Income" type="strong" style="margin-tb-1"/>
                </default-field>
            </field>
            <field name="nonEmploymentTipHeader">
                <default-field>
                    <label text="Alimony, child support, or separate maintenance income need not be provided if you do not wish it to be considered as a basis for repaying this obligation" style="margin-tb-1"/>
                </default-field>
            </field>
            <field name="rentIncome">
                <default-field title="Rent (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="retirementIncome">
                <default-field title="Retirement (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="investmentIncome">
                <default-field title="Investment (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="bonusIncome">
                <default-field title="Bonus (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="socialSecurityIncome">
                <default-field title="Social Security (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="disabilityIncome">
                <default-field title="Disability (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="studentIncome">
                <default-field title="Student Financial Assistance (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="unemploymentIncome">
                <default-field title="Unemployment Compensation (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="alimonyIncome">
                <default-field title="Alimony (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="childSupportIncome">
                <default-field title="Child Support (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="otherIncome">
                <default-field title="Other (Optional)">
                    <text-line/>
                </default-field>
            </field>
            <field name="totalNonEmploymentIncome">
                <default-field title="Total Other Income Monthly">
                    <display dynamic-transition="calculateTotalNonEmploymentIncome" depends-optional="true" style="bg-grey-1">
                        <depends-on field="rentIncome"/>
                        <depends-on field="retirementIncome"/>
                        <depends-on field="investmentIncome"/>
                        <depends-on field="bonusIncome"/>
                        <depends-on field="socialSecurityIncome"/>
                        <depends-on field="disabilityIncome"/>
                        <depends-on field="studentIncome"/>
                        <depends-on field="unemploymentIncome"/>
                        <depends-on field="alimonyIncome"/>
                        <depends-on field="childSupportIncome"/>
                        <depends-on field="otherIncome"/>
                    </display>
                </default-field>
            </field>

            <field name="submitButton">
                <default-field container-style="text-primary">
                    <submit text="Add Employment"/>
                </default-field>
            </field>
            <field name="continueButton">
                <default-field container-style="text-primary">
                    <submit text="Continue"/>
                </default-field>
            </field>
            <field name="backButton">
                <default-field container-style="dark-link">
                    <link url="viewOrderHeader" text="Back" btn-type="default"/>
                </default-field>
            </field>

            <field-layout>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6">
                        <field-ref name="applicantHeader"/>
                        <field-ref name="personaInfoHeader"/>
                    </field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="firstName"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="middleName"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="lastName"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="suffix"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6">
                        <field-ref name="addressHeader"/>
                        <field-ref name="address1"/>
                    </field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="unitNumber"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="postalCode"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="city"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="stateProvinceGeoId"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6">
                        <field-ref name="identityHeader"/>
                    </field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="socialSecurityNumber"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="birthDate"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="idTypeEnumId"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="idIssuedBy"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="idValue"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="idIssueDate"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="idExpiryDate"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="maritalStatusEnumId"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="contactHeader"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="contactNumber"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="contactMechPurposeId"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="email"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="emailVerify"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6">
                        <field-ref name="financialHeader"/>
                        <field-ref name="employmentHeader"/>
                    </field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="occupation"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employmentTipHeader"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employmentRelations"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employmentNumberHeader"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employmentStatusEnumId"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employerName"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="jobTitle"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="durationHeader"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="years"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="months"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="monthlyIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employerAddress1"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="employerUnitNumber"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="employerPostalCode"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="employerCity"/></field-col>
                    <field-col xs="12" sm="5" md="3" lg="3"><field-ref name="employerStateProvinceGeoId"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="employerContactNumber"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="submitButton"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6">
                        <field-ref name="nonEmploymentHeader"/>
                        <field-ref name="nonEmploymentTipHeader"/>
                    </field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="rentIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="retirementIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="investmentIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="bonusIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="socialSecurityIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="disabilityIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="studentIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="unemploymentIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="alimonyIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="childSupportIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="otherIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="12" sm="10" md="6" lg="6"><field-ref name="totalNonEmploymentIncome"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>

                <fields-not-referenced/>

                <field-col-row>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                    <field-col xs="6" sm="5" md="3" lg="3"><field-ref name="backButton"/></field-col>
                    <field-col xs="6" sm="5" md="3" lg="3" style="text-right"><field-ref name="continueButton"/></field-col>
                    <field-col xs="0" sm="1" md="3" lg="3"/>
                </field-col-row>
            </field-layout>
        </form-single>
    </widgets>

</screen>
