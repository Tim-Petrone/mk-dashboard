<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-title="Party Current Employment"
        default-menu-include="false"
        default-menu-index="3">

    <parameter name="orderId" required="true"/>
    <parameter name="orderPartSeqId" required="true"/>
    <parameter name="partyId" required="true"/>

    <transition name="addEmployment">
        <service-call name="mkdecision.dashboard.OrderServices.add#Employment" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="updateEmployment">
        <service-call name="mkdecision.dashboard.OrderServices.update#Employment" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="deleteEmployment">
        <service-call name="mkdecision.dashboard.OrderServices.delete#Employment" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="addIncomeSource">
        <service-call name="mkdecision.dashboard.OrderServices.add#IncomeSource" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="updateIncomeSource">
        <service-call name="mkdecision.dashboard.OrderServices.update#IncomeSource" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="deleteIncomeSource">
        <service-call name="mkdecision.dashboard.OrderServices.delete#IncomeSource" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="partyIdentity">
        <default-response url="../PartyIdentity">
            <parameter name="orderId"/>
            <parameter name="orderPartSeqId"/>
            <parameter name="partyId"/>
        </default-response>
    </transition>
    <transition name="checkEmployment">
        <default-response url="../PartyEmploymentPrevious">
            <parameter name="orderId"/>
            <parameter name="orderPartSeqId"/>
            <parameter name="partyId"/>
        </default-response>
    </transition>

    <actions>
        <entity-find entity-name="mantle.party.PartyToAndRelationship" list="employmentRelationList">
            <econdition field-name="relationshipTypeEnumId" value="PrtEmployee"/>
            <econdition field-name="fromPartyId" from="partyId"/>
            <econdition field-name="fromRoleTypeId" value="Employee"/>
        </entity-find>
        <entity-find entity-name="mk.close.FinancialFlow" list="incomeFinFlowList">
            <econdition field-name="partyId" from="partyId"/>
            <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
            <econdition field-name="partyRelationshipId" operator="is-null" value=""/>
        </entity-find>
    </actions>

    <widgets>
        <container-row>
            <row-col xs="0" sm="1" md="3" lg="3"/>
            <row-col xs="12" sm="10" md="6" lg="6">
                <container style="stepper margin-b-1">
                    <render-mode>
                        <text type="qvt"><![CDATA[
                            <q-stepper ref="stepper" value="s3" color="primary" :flat="true">
                                <q-step name="s1" title="Party" icon="person"/>
                                <q-step name="s2" title="Identity" icon="fingerprint"/>
                                <q-step name="s3" title="Employment" icon="work"/>
                            </q-stepper>
                        ]]></text>
                    </render-mode>
                </container>
            </row-col>
            <row-col xs="0" sm="1" md="3" lg="3"/>
        </container-row>

        <container-row style="form-no-margin">
            <row-col xs="0" sm="1" md="3" lg="3"/>
            <row-col xs="12" sm="10" md="6" lg="6">
                <label text="Current Employment" type="h5" style="margin-b-1"/>
                <label text="Add all current employment sources" style="margin-b-1"/>
                <container style="h-separator margin-tb-2"/>

                <section name="employmentSection">
                    <widgets>
                        <section name="employmentRelationSection" condition="employmentRelationList.size() > 0">
                            <widgets>
                                <section-iterate name="employmentIterator" list="employmentRelationList" entry="employmentRelation">
                                    <actions>
                                        <set field="employerName" from="employmentRelation.organizationName"/>
                                        <set field="jobTitle" from="employmentRelation.relationshipName"/>

                                        <entity-find entity-name="mantle.party.PartyClassificationAppl" list="partyClassList">
                                            <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                                            <date-filter/>
                                        </entity-find>
                                        <set field="employerClassificationId" from="partyClassList?.getFirst()?.partyClassificationId ?: null"/>

                                        <entity-find-one entity-name="mantle.party.PartyRelationshipSetting" value-field="employmentStatusSetting">
                                            <field-map field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                                            <field-map field-name="partySettingTypeId" value="EmploymentStatus"/>
                                        </entity-find-one>
                                        <set field="employmentStatusEnumId" from="employmentStatusSetting.settingValue"/>

                                        <entity-find entity-name="mk.close.FinancialFlow" list="monthlyIncomeFinFlowList">
                                            <econdition field-name="partyId" from="employmentRelation.fromPartyId"/>
                                            <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                                            <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowTotalMonthlyIncome"/>
                                            <econdition field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                                        </entity-find>
                                        <set field="monthlyIncome" from="monthlyIncomeFinFlowList?.getFirst()?.amount ?: null"/>

                                        <set field="millis" from="Math.abs(employmentRelation.fromDate.getTime() - ec.user.nowTimestamp.getTime())"/>
                                        <set field="days" from="java.util.concurrent.TimeUnit.DAYS.convert(millis, java.util.concurrent.TimeUnit.MILLISECONDS)"/>
                                        <set field="years" from="Math.floor(days / 365)"/>
                                        <set field="months" from="Math.floor(days / 30) - (years * 12)"/>

                                        <service-call name="mkdecision.dashboard.PartyServices.get#PartyPrimaryPostalAddress" in-map="[partyId: employmentRelation.toPartyId]" out-map="postalAddressResp"/>
                                        <log message="${postalAddressResp}" level="warn"/>
                                        <set field="employerAddress1" from="postalAddressResp.postalAddress?.address1"/>
                                        <set field="employerUnitNumber" from="postalAddressResp.postalAddress?.unitNumber"/>
                                        <set field="employerPostalCode" from="postalAddressResp.postalAddress?.postalCode"/>
                                        <set field="employerCity" from="postalAddressResp.postalAddress?.city"/>
                                        <set field="employerStateProvinceGeoId" from="postalAddressResp.postalAddress?.stateProvinceGeoId"/>

                                        <service-call name="mkdecision.dashboard.PartyServices.get#PartyPrimaryTelecomNumber" in-map="[partyId: employmentRelation.toPartyId]" out-map="telecomNumberResp"/>
                                        <set field="employerContactNumber" from="telecomNumberResp.telecomNumber"/>
                                    </actions>
                                    <widgets>
                                        <container-row>
                                            <row-col xs="6" sm="6" md="6" lg="6">
                                                <container style="margin-tb-05">
                                                    <label text="${employerName}"/>
                                                </container>
                                            </row-col>
                                            <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                                <container-dialog id="EditRegularEmploymentDialog" button-text="Edit" width="960" condition="employmentStatusEnumId == 'EmpsFullTime' || employmentStatusEnumId == 'EmpsPartTime'">
                                                    <form-single name="EditRegularEmploymentForm" transition="updateEmployment">
                                                        <field name="orderId"><default-field><hidden default-value="${orderId}"/></default-field></field>
                                                        <field name="orderPartSeqId"><default-field><hidden default-value="${orderPartSeqId}"/></default-field></field>
                                                        <field name="partyId"><default-field><hidden default-value="${partyId}"/></default-field></field>
                                                        <field name="partyRelationshipId"><default-field><hidden default-value="${employmentRelation.partyRelationshipId}"/></default-field></field>
                                                        <field name="relationshipTypeEnumId"><default-field><hidden default-value="PrtEmployee"/></default-field></field>

                                                        <field name="employerName">
                                                            <default-field>
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employmentStatusEnumId">
                                                            <default-field title="Employment Status">
                                                                <drop-down required-manual-select="true">
                                                                    <entity-options text="${description}" key="${enumId}">
                                                                        <entity-find entity-name="moqui.basic.Enumeration">
                                                                            <econdition field-name="enumTypeId" value="EmploymentStatus"/>
                                                                            <econditions combine="or">
                                                                                <econdition field-name="enumId" value="EmpsFullTime"/>
                                                                                <econdition field-name="enumId" value="EmpsPartTime"/>
                                                                            </econditions>
                                                                            <order-by field-name="description"/>
                                                                        </entity-find>
                                                                    </entity-options>
                                                                </drop-down>
                                                            </default-field>
                                                        </field>
                                                        <field name="monthlyIncome">
                                                            <default-field title="Gross Income Monthly">
                                                                <text-line input-type="number" format="#.##" prefix="$"/>
                                                            </default-field>
                                                        </field>

                                                        <field name="durationHeader">
                                                            <default-field>
                                                                <label text="Duration" style="margin-tb-1"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="years">
                                                            <default-field>
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="months">
                                                            <default-field>
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="jobTitle">
                                                            <default-field title="Title">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerContactNumber">
                                                            <default-field title="Employer Phone Number (Optional)" validate-service="mkdecision.dashboard.OrderServices.add#Employment">
                                                                <text-line  mask="###-###-####" input-type="tel"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerAddress1">
                                                            <default-field title="Employer Address (Optional)">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerUnitNumber">
                                                            <default-field title="Apt / Unit # (Optional)">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerPostalCode">
                                                            <default-field title="ZIP Code (Optional)">
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerCity">
                                                            <default-field title="Employer City (Optional)">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerStateProvinceGeoId">
                                                            <default-field title="State (Optional)">
                                                                <drop-down allow-empty="true">
                                                                    <entity-options text="${geoName}" key="${toGeoId}">
                                                                        <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                                                            <econdition field-name="geoId" value="USA"/>
                                                                            <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                                                            <order-by field-name="geoName"/>
                                                                        </entity-find>
                                                                    </entity-options>
                                                                </drop-down>
                                                            </default-field>
                                                        </field>

                                                        <field name="submit">
                                                            <default-field>
                                                                <submit text="Save"/>
                                                            </default-field>
                                                        </field>

                                                        <field-layout>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerName"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employmentStatusEnumId"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="monthlyIncome"/></field-col>
                                                            </field-col-row>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="jobTitle"/></field-col>
                                                            </field-col-row>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerContactNumber"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerAddress1"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerUnitNumber"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerPostalCode"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerCity"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerStateProvinceGeoId"/></field-col>
                                                            </field-col-row>

                                                            <fields-not-referenced/>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="submit"/></field-col>
                                                            </field-col-row>
                                                        </field-layout>
                                                    </form-single>
                                                </container-dialog>
                                                <container-dialog id="EditSelfEmploymentDialog" button-text="Edit" width="960" condition="employmentStatusEnumId == 'EmpsContractor' || employmentStatusEnumId == 'EmpsSelf'">
                                                    <form-single name="EditSelfEmploymentForm" transition="updateEmployment">
                                                        <field name="orderId"><default-field><hidden default-value="${orderId}"/></default-field></field>
                                                        <field name="orderPartSeqId"><default-field><hidden default-value="${orderPartSeqId}"/></default-field></field>
                                                        <field name="partyId"><default-field><hidden default-value="${partyId}"/></default-field></field>
                                                        <field name="partyRelationshipId"><default-field><hidden default-value="${employmentRelation.partyRelationshipId}"/></default-field></field>
                                                        <field name="relationshipTypeEnumId"><default-field><hidden default-value="PrtEmployee"/></default-field></field>

                                                        <field name="employerName">
                                                            <default-field title="Business Name">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerClassificationId">
                                                            <default-field title="Business Activity">
                                                                <drop-down required-manual-select="true">
                                                                    <entity-options text="${description}" key="${partyClassificationId}">
                                                                        <entity-find entity-name="mantle.party.PartyClassification">
                                                                            <econdition field-name="classificationTypeEnumId" value="PcltIndustry"/>
                                                                            <order-by field-name="description"/>
                                                                        </entity-find>
                                                                    </entity-options>
                                                                </drop-down>
                                                            </default-field>
                                                        </field>
                                                        <field name="employmentStatusEnumId">
                                                            <default-field title="Employment Status">
                                                                <drop-down required-manual-select="true">
                                                                    <entity-options text="${description}" key="${enumId}">
                                                                        <entity-find entity-name="moqui.basic.Enumeration">
                                                                            <econdition field-name="enumTypeId" value="EmploymentStatus"/>
                                                                            <econditions combine="or">
                                                                                <econdition field-name="enumId" value="EmpsContractor"/>
                                                                                <econdition field-name="enumId" value="EmpsSelf"/>
                                                                            </econditions>
                                                                            <order-by field-name="description"/>
                                                                        </entity-find>
                                                                    </entity-options>
                                                                </drop-down>
                                                            </default-field>
                                                        </field>
                                                        <field name="monthlyIncome">
                                                            <default-field title="Gross Income Monthly">
                                                                <text-line input-type="number" format="#.##" prefix="$"/>
                                                            </default-field>
                                                        </field>

                                                        <field name="durationHeader">
                                                            <default-field>
                                                                <label text="Duration" style="margin-tb-1"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="years">
                                                            <default-field>
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="months">
                                                            <default-field>
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>

                                                        <field name="employerContactNumber">
                                                            <default-field title="Employer Phone Number (Optional)" validate-service="mkdecision.dashboard.OrderServices.add#Employment">
                                                                <text-line  mask="###-###-####" input-type="tel"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerAddress1">
                                                            <default-field title="Employer Address (Optional)">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerUnitNumber">
                                                            <default-field title="Apt / Unit # (Optional)">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerPostalCode">
                                                            <default-field title="ZIP Code (Optional)">
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerCity">
                                                            <default-field title="Employer City (Optional)">
                                                                <text-line/>
                                                            </default-field>
                                                        </field>
                                                        <field name="employerStateProvinceGeoId">
                                                            <default-field title="State (Optional)">
                                                                <drop-down allow-empty="true">
                                                                    <entity-options text="${geoName}" key="${toGeoId}">
                                                                        <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                                                            <econdition field-name="geoId" value="USA"/>
                                                                            <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                                                            <order-by field-name="geoName"/>
                                                                        </entity-find>
                                                                    </entity-options>
                                                                </drop-down>
                                                            </default-field>
                                                        </field>

                                                        <field name="submit">
                                                            <default-field>
                                                                <submit text="Save"/>
                                                            </default-field>
                                                        </field>

                                                        <field-layout>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerClassificationId"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerName"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employmentStatusEnumId"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="monthlyIncome"/></field-col>
                                                            </field-col-row>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                                            </field-col-row>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerContactNumber"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerAddress1"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerUnitNumber"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerPostalCode"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerCity"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerStateProvinceGeoId"/></field-col>
                                                            </field-col-row>

                                                            <fields-not-referenced/>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="submit"/></field-col>
                                                            </field-col-row>
                                                        </field-layout>
                                                    </form-single>
                                                </container-dialog>
                                                <link text="Remove" btn-type="danger" url="deleteEmployment" parameter-map="[orderId: orderId, orderPartSeqId: orderPartSeqId, partyId: partyId, partyRelationshipId: employmentRelation.partyRelationshipId]"/>
                                            </row-col>
                                        </container-row>
                                        <container style="h-separator margin-tb-05"/>
                                    </widgets>
                                </section-iterate>
                                <container style="margin-tb-2"/>
                            </widgets>
                        </section>

                        <container-dialog id="AddRegularEmploymentDialog" button-text="Add Full or Part-time Employment" width="960" button-style="block margin-tb-1">
                            <form-single name="AddRegularEmploymentForm" transition="addEmployment">
                                <field name="orderId"><default-field><hidden default-value="${orderId}"/></default-field></field>
                                <field name="orderPartSeqId"><default-field><hidden default-value="${orderPartSeqId}"/></default-field></field>
                                <field name="partyId"><default-field><hidden default-value="${partyId}"/></default-field></field>
                                <field name="relationshipTypeEnumId"><default-field><hidden default-value="PrtEmployee"/></default-field></field>

                                <field name="employerName">
                                    <default-field>
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employmentStatusEnumId">
                                    <default-field title="Employment Status">
                                        <drop-down required-manual-select="true">
                                            <entity-options text="${description}" key="${enumId}">
                                                <entity-find entity-name="moqui.basic.Enumeration">
                                                    <econdition field-name="enumTypeId" value="EmploymentStatus"/>
                                                    <econditions combine="or">
                                                        <econdition field-name="enumId" value="EmpsFullTime"/>
                                                        <econdition field-name="enumId" value="EmpsPartTime"/>
                                                    </econditions>
                                                    <order-by field-name="description"/>
                                                </entity-find>
                                            </entity-options>
                                        </drop-down>
                                    </default-field>
                                </field>
                                <field name="monthlyIncome">
                                    <default-field title="Gross Income Monthly">
                                        <text-line input-type="number" format="#.##" prefix="$"/>
                                    </default-field>
                                </field>

                                <field name="durationHeader">
                                    <default-field>
                                        <label text="Duration" style="margin-tb-1"/>
                                    </default-field>
                                </field>
                                <field name="years">
                                    <default-field>
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>
                                <field name="months">
                                    <default-field>
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>
                                <field name="jobTitle">
                                    <default-field title="Title">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerAddress1">
                                    <default-field title="Employer Address (Optional)">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerUnitNumber">
                                    <default-field title="Apt / Unit # (Optional)">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerPostalCode">
                                    <default-field title="ZIP Code (Optional)">
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>
                                <field name="employerCity">
                                    <default-field title="Employer City (Optional)">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerStateProvinceGeoId">
                                    <default-field title="State (Optional)">
                                        <drop-down allow-empty="true">
                                            <entity-options text="${geoName}" key="${toGeoId}">
                                                <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                                    <econdition field-name="geoId" value="USA"/>
                                                    <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                                    <order-by field-name="geoName"/>
                                                </entity-find>
                                            </entity-options>
                                        </drop-down>
                                    </default-field>
                                </field>
                                <field name="employerContactNumber">
                                    <default-field title="Employer Phone Number (Optional)" validate-service="mkdecision.dashboard.OrderServices.add#Employment">
                                        <text-line  mask="###-###-####" input-type="tel"/>
                                    </default-field>
                                </field>

                                <field name="submit">
                                    <default-field>
                                        <submit text="Save"/>
                                    </default-field>
                                </field>

                                <field-layout>
                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerName"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employmentStatusEnumId"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="monthlyIncome"/></field-col>
                                    </field-col-row>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="jobTitle"/></field-col>
                                    </field-col-row>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerContactNumber"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerAddress1"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerUnitNumber"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerPostalCode"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerCity"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerStateProvinceGeoId"/></field-col>
                                    </field-col-row>

                                    <fields-not-referenced/>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="submit"/></field-col>
                                    </field-col-row>
                                </field-layout>
                            </form-single>
                        </container-dialog>

                        <container-dialog id="AddSelfEmploymentDialog" button-text="Add Contractor or Self-Employment" width="960" button-style="block margin-tb-1">
                            <form-single name="AddSelfEmploymentForm" transition="addEmployment">
                                <field name="orderId"><default-field><hidden default-value="${orderId}"/></default-field></field>
                                <field name="orderPartSeqId"><default-field><hidden default-value="${orderPartSeqId}"/></default-field></field>
                                <field name="partyId"><default-field><hidden default-value="${partyId}"/></default-field></field>
                                <field name="relationshipTypeEnumId"><default-field><hidden default-value="PrtEmployee"/></default-field></field>

                                <field name="employerName">
                                    <default-field title="Business Name">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerClassificationId">
                                    <default-field title="Business Activity">
                                        <drop-down required-manual-select="true">
                                            <entity-options text="${description}" key="${partyClassificationId}">
                                                <entity-find entity-name="mantle.party.PartyClassification">
                                                    <econdition field-name="classificationTypeEnumId" value="PcltIndustry"/>
                                                    <order-by field-name="description"/>
                                                </entity-find>
                                            </entity-options>
                                        </drop-down>
                                    </default-field>
                                </field>
                                <field name="employmentStatusEnumId">
                                    <default-field title="Employment Status">
                                        <drop-down required-manual-select="true">
                                            <entity-options text="${description}" key="${enumId}">
                                                <entity-find entity-name="moqui.basic.Enumeration">
                                                    <econdition field-name="enumTypeId" value="EmploymentStatus"/>
                                                    <econditions combine="or">
                                                        <econdition field-name="enumId" value="EmpsContractor"/>
                                                        <econdition field-name="enumId" value="EmpsSelf"/>
                                                    </econditions>
                                                    <order-by field-name="description"/>
                                                </entity-find>
                                            </entity-options>
                                        </drop-down>
                                    </default-field>
                                </field>
                                <field name="monthlyIncome">
                                    <default-field title="Gross Income Monthly">
                                        <text-line input-type="number" format="#.##" prefix="$"/>
                                    </default-field>
                                </field>

                                <field name="durationHeader">
                                    <default-field>
                                        <label text="Duration" style="margin-tb-1"/>
                                    </default-field>
                                </field>
                                <field name="years">
                                    <default-field>
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>
                                <field name="months">
                                    <default-field>
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>

                                <field name="employerContactNumber">
                                    <default-field title="Employer Phone Number (Optional)" validate-service="mkdecision.dashboard.OrderServices.add#Employment">
                                        <text-line  mask="###-###-####" input-type="tel"/>
                                    </default-field>
                                </field>
                                <field name="employerAddress1">
                                    <default-field title="Employer Address (Optional)">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerUnitNumber">
                                    <default-field title="Apt / Unit # (Optional)">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerPostalCode">
                                    <default-field title="ZIP Code (Optional)">
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>
                                <field name="employerCity">
                                    <default-field title="Employer City (Optional)">
                                        <text-line/>
                                    </default-field>
                                </field>
                                <field name="employerStateProvinceGeoId">
                                    <default-field title="State (Optional)">
                                        <drop-down allow-empty="true">
                                            <entity-options text="${geoName}" key="${toGeoId}">
                                                <entity-find entity-name="moqui.basic.GeoAssocAndToDetail">
                                                    <econdition field-name="geoId" value="USA"/>
                                                    <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                                                    <order-by field-name="geoName"/>
                                                </entity-find>
                                            </entity-options>
                                        </drop-down>
                                    </default-field>
                                </field>

                                <field name="submit">
                                    <default-field>
                                        <submit text="Save"/>
                                    </default-field>
                                </field>

                                <field-layout>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerClassificationId"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerName"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employmentStatusEnumId"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="monthlyIncome"/></field-col>
                                    </field-col-row>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                    </field-col-row>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerContactNumber"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="employerAddress1"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerUnitNumber"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerPostalCode"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerCity"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="employerStateProvinceGeoId"/></field-col>
                                    </field-col-row>

                                    <fields-not-referenced/>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="submit"/></field-col>
                                    </field-col-row>
                                </field-layout>
                            </form-single>
                        </container-dialog>
                    </widgets>
                </section>

                <label text="Current Non-Employment Income" type="h5" style="margin-t-2 margin-b-1"/>
                <label text="Add all current non-employment income sources. Alimony, child support, or separate maintenance income need not be provided if applicant does not wish it to be considered as a basis for repaying this obligation." style="margin-b-1"/>
                <container style="h-separator margin-tb-2"/>

                <section name="currentIncomeSection">
                    <widgets>
                        <section name="incomeSection" condition="incomeFinFlowList.size() > 0">
                            <widgets>
                                <section-iterate name="incomeIterator" list="incomeFinFlowList" entry="incomeFinFlow">
                                    <actions>
                                        <entity-find-related-one value-field="incomeFinFlow" relationship-name="flowType" to-value-field="flowType"/>
                                        <set field="financialFlowTypeEnumId" from="incomeFinFlow.financialFlowTypeEnumId"/>
                                        <set field="amount" from="incomeFinFlow.amount"/>

                                        <set field="millis" from="Math.abs(incomeFinFlow.fromDate.getTime() - ec.user.nowTimestamp.getTime())"/>
                                        <set field="days" from="java.util.concurrent.TimeUnit.DAYS.convert(millis, java.util.concurrent.TimeUnit.MILLISECONDS)"/>
                                        <set field="years" from="Math.floor(days / 365)"/>
                                        <set field="months" from="Math.floor(days / 30) - (years * 12)"/>
                                    </actions>
                                    <widgets>
                                        <container-row>
                                            <row-col xs="6" sm="6" md="6" lg="6">
                                                <container style="margin-tb-05">
                                                    <label text="${flowType.description}"/>
                                                </container>
                                            </row-col>
                                            <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                                <container-dialog id="EditIncomeSourceDialog" button-text="Edit" width="960">
                                                    <form-single name="EditIncomeSourceForm" transition="updateIncomeSource">
                                                        <field name="orderId"><default-field><hidden default-value="${orderId}"/></default-field></field>
                                                        <field name="orderPartSeqId"><default-field><hidden default-value="${orderPartSeqId}"/></default-field></field>
                                                        <field name="partyId"><default-field><hidden default-value="${partyId}"/></default-field></field>
                                                        <field name="financialFlowId"><default-field><hidden default-value="${incomeFinFlow.financialFlowId}"/></default-field></field>

                                                        <field name="financialFlowTypeEnumId">
                                                            <default-field title="Income Source Type">
                                                                <drop-down required-manual-select="true">
                                                                    <entity-options text="${enumDescription}" key="${enumId}">
                                                                        <entity-find entity-name="moqui.basic.EnumGroupEnumAndParent">
                                                                            <econdition field-name="enumGroupEnumId" value="DefaultDashboardIncomeSourceGroup"/>
                                                                            <order-by field-name="enumDescription"/>
                                                                        </entity-find>
                                                                    </entity-options>
                                                                </drop-down>
                                                            </default-field>
                                                        </field>
                                                        <field name="amount">
                                                            <default-field title="Gross Income Monthly">
                                                                <text-line input-type="number" format="#.##" prefix="$"/>
                                                            </default-field>
                                                        </field>

                                                        <field name="durationHeader">
                                                            <default-field>
                                                                <label text="Duration" style="margin-tb-1"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="years">
                                                            <default-field>
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>
                                                        <field name="months">
                                                            <default-field>
                                                                <text-line input-type="number"/>
                                                            </default-field>
                                                        </field>

                                                        <field name="submit">
                                                            <default-field>
                                                                <submit text="Save"/>
                                                            </default-field>
                                                        </field>

                                                        <field-layout>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="financialFlowTypeEnumId"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="amount"/></field-col>
                                                            </field-col-row>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                                            </field-col-row>
                                                            <field-col-row>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                                                <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                                            </field-col-row>

                                                            <fields-not-referenced/>

                                                            <field-col-row>
                                                                <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="submit"/></field-col>
                                                            </field-col-row>
                                                        </field-layout>
                                                    </form-single>
                                                </container-dialog>
                                                <link text="Remove" btn-type="danger" url="deleteIncomeSource" parameter-map="[orderId: orderId, orderPartSeqId: orderPartSeqId, partyId: partyId, financialFlowId: incomeFinFlow.financialFlowId]"/>
                                            </row-col>
                                        </container-row>
                                        <container style="h-separator margin-tb-05"/>
                                    </widgets>
                                </section-iterate>
                                <container style="margin-tb-2"/>
                            </widgets>
                        </section>

                        <container-dialog id="AddIncomeSourceDialog" button-text="Add Income Source" width="960" button-style="block margin-tb-1">
                            <form-single name="AddIncomeSourceForm" transition="addIncomeSource">
                                <field name="orderId"><default-field><hidden default-value="${orderId}"/></default-field></field>
                                <field name="orderPartSeqId"><default-field><hidden default-value="${orderPartSeqId}"/></default-field></field>
                                <field name="partyId"><default-field><hidden default-value="${partyId}"/></default-field></field>

                                <field name="financialFlowTypeEnumId">
                                    <default-field title="Income Source Type">
                                        <drop-down required-manual-select="true">
                                            <entity-options text="${enumDescription}" key="${enumId}">
                                                <entity-find entity-name="moqui.basic.EnumGroupEnumAndParent">
                                                    <econdition field-name="enumGroupEnumId" value="DefaultDashboardIncomeSourceGroup"/>
                                                    <order-by field-name="enumDescription"/>
                                                </entity-find>
                                            </entity-options>
                                        </drop-down>
                                    </default-field>
                                </field>
                                <field name="amount">
                                    <default-field title="Gross Income Monthly">
                                        <text-line input-type="number" format="#.##" prefix="$"/>
                                    </default-field>
                                </field>

                                <field name="durationHeader">
                                    <default-field>
                                        <label text="Duration" style="margin-tb-1"/>
                                    </default-field>
                                </field>
                                <field name="years">
                                    <default-field>
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>
                                <field name="months">
                                    <default-field>
                                        <text-line input-type="number"/>
                                    </default-field>
                                </field>

                                <field name="submit">
                                    <default-field>
                                        <submit text="Save"/>
                                    </default-field>
                                </field>

                                <field-layout>
                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="financialFlowTypeEnumId"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="amount"/></field-col>
                                    </field-col-row>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="durationHeader"/></field-col>
                                    </field-col-row>
                                    <field-col-row>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="years"/></field-col>
                                        <field-col xs="12" sm="6" md="6" lg="6"><field-ref name="months"/></field-col>
                                    </field-col-row>

                                    <fields-not-referenced/>

                                    <field-col-row>
                                        <field-col xs="12" sm="12" md="12" lg="12"><field-ref name="submit"/></field-col>
                                    </field-col-row>
                                </field-layout>
                            </form-single>
                        </container-dialog>
                    </widgets>
                </section>

                <container style="margin-tb-2"/>

                <container-row>
                    <row-col xs="6" sm="6" md="6" lg="6" style="padding-all-0">
                        <link url="partyIdentity" text="Back" style="text-black"/>
                    </row-col>
                    <row-col xs="6" sm="6" md="6" lg="6" style="padding-all-0 text-right">
                        <link url="checkEmployment" text="Continue" btn-type="default" parameter-map="[orderId: orderId, orderPartSeqId: orderPartSeqId, partyId: partyId]"/>
                    </row-col>
                </container-row>
            </row-col>
            <row-col xs="0" sm="1" md="3" lg="3"/>
        </container-row>
    </widgets>

</screen>
